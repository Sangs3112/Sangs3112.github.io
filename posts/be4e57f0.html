<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MySQL笔记_3 | Sangs Blog</title><meta name="author" content="Sangs"><meta name="copyright" content="Sangs"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="SQL优化 insert优化  使用批量插入，一次性插入500~1000条数据，而不是一条一条插入，也不能一次性插入过多 使用手动事务提交 主键顺序插入 如果需要插入大批量的数据，可以使用MySQL提供的load指令，而不使用insert 12345678-- 使用load需要修改-- 客户端链接服务端 加上--local-infile参数mysql \-\-local-infile -u roo">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL笔记_3">
<meta property="og:url" content="https://sangs3112.github.io/posts/be4e57f0.html">
<meta property="og:site_name" content="Sangs Blog">
<meta property="og:description" content="SQL优化 insert优化  使用批量插入，一次性插入500~1000条数据，而不是一条一条插入，也不能一次性插入过多 使用手动事务提交 主键顺序插入 如果需要插入大批量的数据，可以使用MySQL提供的load指令，而不使用insert 12345678-- 使用load需要修改-- 客户端链接服务端 加上--local-infile参数mysql \-\-local-infile -u roo">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://sangs3112.github.io/img/avatar.png">
<meta property="article:published_time" content="2024-03-14T05:38:14.000Z">
<meta property="article:modified_time" content="2025-08-25T10:41:31.954Z">
<meta property="article:author" content="Sangs">
<meta property="article:tag" content="MySQL">
<meta property="article:tag" content="SQL优化">
<meta property="article:tag" content="存储过程">
<meta property="article:tag" content="触发器">
<meta property="article:tag" content="视图">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://sangs3112.github.io/img/avatar.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://sangs3112.github.io/posts/be4e57f0.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><meta name="google-site-verification" content="https://github.com/Sangs3112/Sangs3112.github.io/blob/master/googlea12c1ab75804fd8f.html"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL笔记_3',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-08-25 18:41:31'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><meta name="referrer" content="no-referrer" /><!-- hexo injector head_end start --><link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Sangs Blog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">47</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">80</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw fas fa-home faa-tada"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><i class="fa-fw fas fa-folder-open faa-tada"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><i class="fa-fw fas fa-tags faa-tada"></i><span> 标签</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Sangs Blog"><span class="site-name">Sangs Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw fas fa-home faa-tada"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><i class="fa-fw fas fa-folder-open faa-tada"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><i class="fa-fw fas fa-tags faa-tada"></i><span> 标签</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">MySQL笔记_3</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-03-14T05:38:14.000Z" title="发表于 2024-03-14 13:38:14">2024-03-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-08-25T10:41:31.954Z" title="更新于 2025-08-25 18:41:31">2025-08-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MySQL/">MySQL</a></span></div><div class="meta-secondline"></div></div></div><article class="post-content" id="article-container"><h1><code>SQL</code>优化</h1>
<h2 id="insert优化"><code>insert</code>优化</h2>
<ol>
<li>使用批量插入，一次性插入500~1000条数据，而不是一条一条插入，也不能一次性插入过多</li>
<li>使用手动事务提交</li>
<li>主键顺序插入</li>
<li>如果需要插入大批量的数据，可以使用<code>MySQL</code>提供的<code>load</code>指令，而不使用<code>insert</code> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用load需要修改</span></span><br><span class="line"><span class="comment">-- 客户端链接服务端 加上--local-infile参数</span></span><br><span class="line">mysql \<span class="operator">-</span>\<span class="operator">-</span><span class="keyword">local</span><span class="operator">-</span>infile <span class="operator">-</span>u root <span class="operator">-</span>p</span><br><span class="line"><span class="comment">-- 设置全局参数local-infile为1，开启本地加载文件到数据库的开关</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> <span class="keyword">local</span><span class="operator">-</span>infile <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 执行load指令 将准备好的数据加载到表结构中</span></span><br><span class="line">load data <span class="keyword">local</span> infile <span class="string">&#x27;/root/sql1.log&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> <span class="string">&#x27;user&#x27;</span> fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> lines terminated <span class="keyword">by</span> <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"><span class="comment">-- 每个字段之间使用,分割，每行之间使用&#x27;\n&#x27;分割</span></span><br></pre></td></tr></table></figure>
</li>
<li>对于<code>load</code>命令而言，同样顺序插入比乱序插入更好</li>
</ol>
<h2 id="主键优化">主键优化</h2>
<div class="note info flat"><ul>
<li>表数据都是根据主键顺序存放的，这种存储方式的表称为索引组织表(<code>index organized table, IOT</code>)</li>
<li><code>InnoDB</code>中的页可以为空，也可以填充一半，或者存满。规定每个页至少包含两行数据，最多包含<code>N</code>行数据。因为如果只有一行数据，相当于形成了一个链表，如果一行数据比较大，超出于阈值后又会形成溢出现象。</li>
<li>行与行之间根据主键排列</li>
</ul>
</div>
<h3 id="主键顺序插入">主键顺序插入</h3>
<ul>
<li>如果主键顺序插入，则一页存放满以后自动开启新页并将数据存放其中<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/sang3112/blog_imgs/raw/master/MySQL/primary_key_ordered.png" alt="primary_key_ordered"></li>
</ul>
<h3 id="主键乱序插入">主键乱序插入</h3>
<ul>
<li>如果主键乱序插入，存放满以后，开启新的数据页，找到本应该要存放的数据页的50%的位置，后面的行移动到新的数据页，再决定要插入的行存放在原来剩下的50%的数据页中还是新数据页中，最后改变链表指针, 称为<strong>页分裂</strong></li>
<li>删除一行记录时，没有物理删除，只是标记为删除并且可以被其他记录使用</li>
<li>页中删除的记录达到<code>MERGE_THRESHOLD</code>，即默认页的50%时，<code>InnoDB</code>就会查找最近的前后两个页是否可以合并，如果可以合并，就会优化空间，称为<strong>页合并</strong><br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/sang3112/blog_imgs/raw/master/MySQL/primary_key_unordered_1.png" alt="primary_key_unordered_1"><br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/sang3112/blog_imgs/raw/master/MySQL/primary_key_unordered_2.png" alt="primary_key_unordered_2"><br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/sang3112/blog_imgs/raw/master/MySQL/primary_key_unordered_3.png" alt="primary_key_unordered_3"></li>
</ul>
<div class="note info flat"><p>推荐使用主键自增</p>
<ul>
<li>比如身份证号，如果拿身份证号作为主键，导致所有二级索引存储主键的值就会占用<code>20B</code>，如果是自增主键，大小就会很小，所以主键长度越小，普通索引的叶子节点就越小，占用空间也就越小。</li>
<li>但是如果只有一个唯一索引，并且是<code>K-V</code>键值对查询的索引，那就可以不用主键自增，避免回表</li>
</ul>
</div>
<h3 id="主键设计原则">主键设计原则</h3>
<ol>
<li>满足业务需求的情况下尽量降低主键的长度。因为主键索引只有一个，二级索引的叶子节点中记录的是主键，如果主键较长，会占用较多的磁盘空间。</li>
<li>插入数据使用<strong>顺序插入</strong>，使用<code>auto_increment</code></li>
<li>不要使用<code>UUID</code>或者身份证号作为主键</li>
<li>避免对主键的修改</li>
</ol>
<h2 id="order-by优化"><code>order by</code>优化</h2>
<div class="note info flat"><ol>
<li><code>Using filesort</code>: 通过<strong>表索引</strong>或<strong>全表扫描</strong>，读取满足条件的数据行。在排序缓冲区中<code>sort buffer</code>完成排序操作，所有不是通过索引直接返回排序结果的排序都是<code>filesort</code>排序</li>
<li><code>Using index</code>: 通过有序索引顺序扫描直接返回有序数据，就是<code>using index</code>，不需要额外的排序，操作效率高。</li>
</ol>
</div>
<ul>
<li>当没有<code>(age, phone)</code>这个联合索引的时候，<code>select id, age, phone from user order by age, phone;</code>这个查询语句使用的是<code>using filesort</code></li>
<li>当有<code>(age, phone)</code>这个联合索引的时候，则该语句使用<code>using index</code>
<ul>
<li>若语句改变为<code>select id, age, phone from user order by age desc, phone desc;</code> 依然是<code>using index</code></li>
<li>但是如果语句改变为<code>select id, age, phone from user order by age, phone desc;</code> 则会出现前一个使用<code>using index</code>，后一个变为<code>using filesort</code>这是因为创建索引的时候值都是从小到大排列的，可以通过<code>show index from user</code>查看其中的<code>Collection</code>列是<code>A</code>就表示升序排列</li>
<li>为了解决这个问题，只需要在创建索引的时候指定顺序即可，比如<code>create index idx_user_age_phone_ad on user(age asc, phone desc);</code> 此时在进行上一次的排序，就会发现<code>using index</code></li>
<li>如果排序变为<code>select id, age, phone from user order by phone, age;</code> 就会出现前一个使用<code>using filesort</code>，后一个使用<code>using index</code>，因为这个违背了最左前缀法则，所以会出现两个。这个不像<code>where ... and ...</code>可以自动匹配顺序变化。</li>
</ul>
</li>
</ul>
<div class="note info flat"><ul>
<li>如果有联合索引，则全部是升序排序，或者全部是降序排序，均可实现<code>using index</code>；</li>
<li>但是如果一个是升序，另一个是降序，则需要在创建一个指定排序的索引才行</li>
<li>这些都是建立在覆盖索引，不需要回表查询的基础上。如果需要回表，则一定是<code>using filesort</code>，比如: <code>select * from user order by age, phone;</code></li>
</ul>
</div>
<h3 id="排序设计原则">排序设计原则</h3>
<ol>
<li>建立合适的索引，多字段排序也遵循最左前缀法则</li>
<li>使用覆盖索引</li>
<li>多字段排序，一个升序一个降序，注意联合索引在创建时的规则</li>
<li>不可避免出现<code>filesort</code>的情况下，出现大数据排序时可以增大缓冲区的大小，<code>sort_buffer_size</code>默认为<code>256K</code></li>
</ol>
<div class="note info flat"><p><code>select city,name,age from t where city='杭州' order by name limit 1000;</code></p>
<ul>
<li>初始化<code>sort buffer</code>, 确定要放入<code>city name age</code>字段</li>
<li>从索引<code>city</code>中根据索引找到第一个满足条件的主键ID</li>
<li>根据主键ID返回<code>name city age</code>存入<code>sort buffer</code></li>
<li>从索引ID取下一个符合要求的主键ID，直到取完</li>
<li><code>sort buffer</code>按照<code>name</code>快排</li>
<li>取<code>1000</code>行返回</li>
</ul>
<blockquote>
<p>这是全字段排序，可能在内存中完成，也可能在外部完成，取决于<code>sort_buffer_size</code>, <code>number_of_tmp_files</code>表示排序的过程中需要使用的临时文件个数，所以配置的<code>sort_buffer_size</code>越小，<code>number_of_tmp_files</code>就越大</p>
</blockquote>
<ul>
<li>全字段排序如果一行内容很多，就会导致<code>sort buffer</code>放不下，产生很多临时文件，性能就不好</li>
<li>配置<code>max_length_for_sort_data</code>，如果单行长度超过这个值，<code>MySQL</code>就会换一个排序方法
<ul>
<li>如果<code>max_length_for_sort_data</code>变小，比如只能放入<code>name</code>，就不能直接返回了</li>
<li>初始化<code>sort buffer</code>，确定放入<code>name</code>和<code>id(rowid)</code></li>
<li>根据<code>city</code>索引找到主键id，根据主键id返回<code>name</code>和<code>id</code>字段，存入<code>sort buffer</code>中</li>
<li>从索引<code>city</code>取下一个主键ID，重复，直到不满足<code>city</code>条件为止</li>
<li><code>sort buffer</code>对<code>name</code>字段排序</li>
<li>结果根据id找到<code>city name age</code>返回</li>
<li>所以比全字段排序多了一次回表</li>
</ul>
</li>
<li>如果建立<code>(city,name)</code>联合索引，这条语句就不会进行排序
<ul>
<li>从索引<code>city</code>中找到第一个满足条件的主键ID</li>
<li>从主键ID找到<code>city name age</code>作为结果集的一部分直接返回</li>
</ul>
</li>
<li>如果建立<code>(city, name, age)</code>联合索引，则变成了覆盖索引，不需要回表，直接返回结果</li>
</ul>
</div>
<ul>
<li>如果<code>explain</code>的结果中，是<code>using temporary, using filesort</code>的话，那么结果就是需要临时表，并且需要排序</li>
</ul>
<div class="note info flat"><p>如果现在有单词表，需要每次随机显示三个单词:<code>select word from words order by rand() limit 3;</code></p>
<ul>
<li>
<p>创建临时表，引擎<code>Memory</code>，两个字段，一个随机值<code>R</code>，一个单词<code>word</code>，没有索引</p>
</li>
<li>
<p>按照单词表主键顺序读出<code>word</code>，生成<code>0-1</code>之间的随机数，存入临时表中</p>
</li>
<li>
<p>按照字段<code>R</code>排序</p>
<ul>
<li>初始化<code>sort buffer</code>， 两个字段，一个是<code>double</code>，一个是整型</li>
<li>从内存临时表读取<code>R</code>和<code>rowid</code>，存入<code>sort buffer</code>中</li>
<li><code>sort buffer</code>根据<code>R</code>进行排序</li>
<li>取前三个<code>rowid</code>，根据<code>rowid</code>在内存表找到对应的<code>word</code>，返回</li>
</ul>
</li>
<li>
<p>对于<code>InnoDB</code>表，全字段排序减少磁盘访问，会优先选择</p>
</li>
<li>
<p><code>order by rowid</code>用的就是内存表进行排序</p>
</li>
<li>
<p>对于内存表，回表就是根据行数据，直接访问内存得到数据，不会多访问磁盘，所以优化器优先考虑行越小越好，所以会选择根据<code>rowid</code>排序</p>
</li>
<li>
<p><code>rowid</code>就是<code>InnoDB</code>唯一标识数据行的值，如果主键被删除了，<code>InnoDB</code>会自动生成一个<code>6B</code>的<code>rowid</code></p>
</li>
<li>
<p>对于<code>Memory</code>引擎，<code>rowid</code>就是数组下标。如果内存临时表中进行排序，这个临时表就是<code>Memory</code>引擎的</p>
</li>
<li>
<p><code>tmp_table_size</code>参数设置了内存临时表的大小，默认<code>16MB</code>，超过大小就是磁盘临时表，<code>InnoDB</code>引擎，如果使用磁盘临时表，就是一个没有显式主键的<code>InnoDB</code>表排序过程</p>
</li>
<li>
<p>如果<code>limit</code>值特别小的情况，引擎会使用优先队列排序优化</p>
</li>
</ul>
</div>
<h2 id="limit优化"><code>limit</code>优化</h2>
<div class="note info flat"><ul>
<li>由于需要排序记录，并且将其他记录全部丢弃，查询排序的时间非常长。因此，<code>limit</code>越往后时间越长</li>
<li>可以使用<strong>覆盖索引 + 子查询</strong>的形式优化</li>
</ul>
</div>
<ul>
<li>原始语句: <code>select * from 表名 order by id limit 9000000, 10;</code></li>
<li>覆盖索引: <code>select id from 表名 order by id limit 9000000, 10;</code></li>
<li>子查询: <code>select * from 表名 where id in (select id from 表名 order by id limit 9000000, 10);</code> 这句话会报错，因为不能在<code>in</code>后面使用<code>limit</code></li>
<li><code>select s.* from 表名 s, (select id from 表名 order by id limit 90000000, 10) a where s.id=a.id;</code> 将limit查询结果作为一个表联合查询</li>
</ul>
<h2 id="count优化"><code>count</code>优化</h2>
<div class="note info flat"><ul>
<li><code>MyISAM</code>把表的总行数存储在磁盘上，<code>count(*)</code>直接返回这个数，效率高，前提是没有<code>where</code>条件</li>
<li><code>InnoDB</code>即使没有<code>where</code>条件，也需要将数据一行一行读出，然后累加
<ul>
<li>这是因为<code>MVCC</code>，所以不能记录<code>count(*)</code>的值直接返回，因为每一次返回的值是不确定的</li>
<li><code>InnoDB</code>会保证逻辑正确的情况下，找索引树最小的那棵来遍历计数</li>
</ul>
</li>
<li>优化只有自己计数，例如使用<code>redis</code></li>
</ul>
</div>
<ul>
<li><code>count(列名)</code>返回的是列中不为<code>null</code>的个数，</li>
<li><code>count(主键)</code>遍历整张表，把每一行主键id取出，返回给服务层，服务层拿到主键以后直接累加，因为主键不会为<code>null</code></li>
<li><code>count(字段)</code>需要看字段是否有<code>not null</code>约束，如果没有该约束，需要将每行字段值取出，返回给服务层。服务层判断是否为<code>null</code>，不为<code>null</code>才累加计数
<ul>
<li>如果有<code>not null</code>约束，则跟主键处理一样</li>
</ul>
</li>
<li><code>count(1)</code>遍历整张表，但是不取值，服务层对于返回的每一行，都放一个数字1进去，直接按行累加。参数是什么数字都可以，0，-1都可以，返回一样的结果</li>
<li><code>count(*)</code>不会把全部字段取出来，而是专门优化了，直接在服务层累加</li>
<li>所以最终的效率<code>count(*)</code>性能最高，类似于<code>count(1)</code>，然后才是<code>count(主键)</code>，性能最差的是<code>count(字段)</code>, 推荐使用<code>count(*)</code></li>
</ul>
<h3 id="缓存系统计数">缓存系统计数</h3>
<ul>
<li>使用<code>Redis</code>计数，插入一行，计数就加一，反之减一
<ul>
<li>可能丢失更新，<code>Redis</code>在内存中，虽然可以持久化保存在磁盘中，如果没有保存的时候异常重启了，那么再启动时，<code>Redis</code>从磁盘中得到的数据就丢失了，不过可以通过异常重启以后执行<code>count(*)</code>更新值</li>
<li>就算这样，逻辑也会有问题，比如取出总数同时显示最近100条，就需要从<code>Redis</code>中取出数据，再从<code>MySQL</code>中取100条
<ul>
<li>返回的100条的时候可能新加入了数据</li>
<li>可能100条数据中有新数据，但是<code>Redis</code>没有 + 1</li>
<li>可能100条数据中没有新数据，但是<code>Redis</code> + 1</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="数据库计数">数据库计数</h3>
<ul>
<li>单独存储一张表用来计数</li>
<li>可以崩溃恢复</li>
<li>可以利用事务隔离保证计数和返回的结果不会有偏差</li>
</ul>
<h2 id="update优化"><code>update</code>优化</h2>
<ul>
<li>更新数据时，<strong>根据索引字段级进行更新，否则行锁会升级成表锁。</strong></li>
<li><code>update course set name='Java' where id=1;</code>这句话是行锁，别的事务更新别的行不会被卡住</li>
<li><code>update course set name='Springboot' where name='kafka';</code>这句话是表锁，别的事务更新别的行会被卡住，因为<code>name</code>字段没有索引
<ul>
<li>如果建立了<code>name</code>的索引，则上句更新就是行锁了</li>
</ul>
</li>
<li>一定要根据索引字段进行更新！否则表锁会锁住整张表。</li>
</ul>
<h1>存储对象: 视图、存储过程、触发器、存储函数</h1>
<h2 id="视图">视图</h2>
<div class="note info flat"><ul>
<li>视图是虚拟存在的表，视图中的数据不在数据库中真实存在，行列数据来自视图查询中使用的表，称为基表，在使用视图时动态生成</li>
<li>视图只保存<code>SQL</code>逻辑，不保存查询结果。创建视图主要工作在<code>SQL</code>查询语句上</li>
</ul>
</div>
<h3 id="增">增</h3>
<ul>
<li>创建视图: <code>create [or replace] view 视图名[(列名列表)] as select语句 [with [cascade | local] check option];</code>
<ul>
<li>替换视图就使用<code>or replace</code></li>
<li><code>select语句</code>关联的表就是<strong>基表</strong></li>
<li>创建视图的时候指定<code>with cascade check option</code>，并且设置了视图<code>select语句</code>为<code>where id &lt; 20</code>，若此时增加了一条<code>id = 30</code>的数据就会报错，提示无法插入。如果没有设置<code>check option</code>就不会报错，可以正常插入</li>
</ul>
</li>
</ul>
<h3 id="删">删</h3>
<ul>
<li>删除视图: <code>drop view [if exists] 视图名[, 视图名1, ...];</code></li>
</ul>
<h3 id="改">改</h3>
<ul>
<li>替换视图: <code>create or replace view 视图名[(列名列表)] as select语句 [with [cascade | local] check option];</code></li>
<li>修改视图: <code>alter view 视图名[(列名列表)] as select语句 [with [cascade | local] check option];</code></li>
</ul>
<h3 id="查">查</h3>
<ul>
<li>查询创建视图语句: <code>show create view 视图名;</code></li>
<li>查看视图数据: <code>select * from 视图名;</code>视图就是虚拟存在的表，所以可以跟操作表一样操作视图</li>
</ul>
<div class="note info flat"><ul>
<li>在视图中插入数据会插入到对应的基表中，因为视图不会保存数据。</li>
<li><code>with check option</code> 就是检查项，在增删改的时候都会检查是否符合视图创建时的定义。<code>MySQL</code>允许创建视图的视图，检查依赖视图规则有两个选项，就是<code>cascade</code>以及<code>local</code></li>
</ul>
</div>
<h3 id="cascade"><code>cascade</code></h3>
<ul>
<li><code>create view v1 as select id, name from student where id &lt;= 20;</code> 这里<strong>没有设置</strong><code>check option</code>，所以修改数据不会检查<code>id &lt;= 20</code></li>
<li><code>create view v2 as select id, name from v1 where id &gt;= 10 with cascade check option;</code> 这里修改了<code>v2</code>的数据时，不仅会检查<code>id &gt;= 10</code>，还会检查<code>id &lt;= 20</code></li>
<li><code>create view v3 as select id, name from v2 where id &lt;= 15;</code> 这里修改<code>v3</code>的数据<code>&gt; 15</code>也可以插入，但是如果<code>&gt; 20</code>则不能插入，因为不能满足<code>v2</code>的检查项</li>
</ul>
<h3 id="local"><code>local</code></h3>
<ul>
<li><code>create view v1 as select id, name from student where id &lt;= 15;</code> 修改<code>v1</code>中的数据不会检查<code>id &lt;= 15</code></li>
<li><code>create view v2 as select id, name from v1 where id &gt;= 10 with local check option;</code> 先检查是否满足<code>v2</code>条件，然后再找<code>v1</code>是否需要检查，发现<code>v1</code>不需要检查，则直接插入。所以插入<code>id = 17</code>也可以</li>
<li><code>create view v3 as select id, name from v2 where id &lt; 20;</code> 没有定义检查选项，会先找<code>v2</code>的检查项，发现<code>v2</code>需要检查<code>id &gt;= 10</code>，再发现<code>v1</code>没有检查选项，所以最终<code>id &gt;= 10</code>即可</li>
</ul>
<div class="note info flat"><ul>
<li>视图如果要能够更新，必须满足视图中的行与基表中的行<strong>一对一关系</strong>，只要包含下面<strong>任意一项</strong>，则视图不可更新
<ol>
<li>聚合函数或窗口函数<code>sum, min, max, count</code></li>
<li><code>distinct</code></li>
<li><code>group by</code></li>
<li><code>having</code></li>
<li><code>union</code>, <code>union all</code></li>
</ol>
</li>
</ul>
</div>
<h3 id="视图作用">视图作用</h3>
<ol>
<li>操作简单，将复杂的经常使用的查询定义在视图中，不需要每次都指定同样的相同操作</li>
<li>安全，由于<code>MySQL</code>不能授权到特定的行列，只能授权到表。所以可以通过视图修改用户能见到的数据</li>
<li>数据独立: 可以帮助用户屏蔽真实表结构带来的变化</li>
</ol>
<h3 id="例子">例子:</h3>
<ol>
<li>为了保证安全性，操作<code>user</code>表时，只能看到用户的基本字段，屏蔽手机号和邮箱两个字段:<br>
<code>create view user_view as select id, name, profession, age, gender, status, create_time from user;</code></li>
<li>为了简化操作，查询每个学生所选修课程，三表联查，定义一个视图: <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.name, s.no, c.name <span class="keyword">from</span> student s, student_course sc, course c <span class="keyword">where</span> s.id <span class="operator">=</span> sc.studentid <span class="keyword">and</span> c.id <span class="operator">=</span> sc.courseid;</span><br><span class="line"><span class="comment">-- 封装成视图</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> stu_course_view <span class="keyword">as</span> <span class="keyword">select</span> s.name studentname, s.no studentno, c.name coursename </span><br><span class="line"><span class="keyword">from</span> student s, student_course sc, course c <span class="keyword">where</span> s.id <span class="operator">=</span> sc.studentid <span class="keyword">and</span> c.id <span class="operator">=</span> sc.courseid;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="存储过程">存储过程</h2>
<div class="note info flat"><ul>
<li>很多地方<strong>禁止</strong>使用</li>
<li>事先编译并存储在数据库中的一段<code>SQL</code>语句集合，减少数据库和应用服务器之间的传输，提高数据处理效率</li>
<li>就是<code>SQL</code>语句封装重用</li>
<li>特点：封装、复用；可以接收参数和返回数据；减少网络交互，提升效率</li>
</ul>
</div>
<h3 id="增-2">增</h3>
<ul>
<li>创建存储过程  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> 存储过程名称([<span class="keyword">in</span><span class="operator">/</span><span class="keyword">out</span><span class="operator">/</span><span class="keyword">inout</span>参数列表])</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="comment">-- SQL语句</span></span><br><span class="line"><span class="keyword">end</span>; <span class="comment">-- 这里有个分号</span></span><br><span class="line"><span class="comment">-- 如果是在命令行中创建存储过程，遇到分号就自动结束了，所以会报错，需要通过delimiter指定sql语句结束符</span></span><br><span class="line"><span class="comment">--  delimiter $$</span></span><br><span class="line"><span class="comment">--  会一直到$$才认为是语句结束了</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="删-2">删</h3>
<ul>
<li>删除存储过程: <code>drop procedure if exists 存储过程名;</code></li>
</ul>
<h3 id="调用">调用</h3>
<ul>
<li>调用存储过程: <code>call 存储过程名([参数])</code></li>
</ul>
<h3 id="查-2">查</h3>
<ul>
<li>查询指定数据库的存储过程以及状态信息: <code>select * from information_schema.routines where routine_schema='xxx';</code></li>
<li>查询存储过程定义: <code>show create procedure 存储过程名;</code></li>
</ul>
<h3 id="变量">变量</h3>
<p><code>MySQL</code>变量分为三类，系统变量，用户自定义变量以及局部变量</p>
<div class="note info flat"><ul>
<li>存储过程的参数类型：<code>in, out, inout</code>三种类型，默认是<code>in</code>类型的，作为输入，<code>out</code>类型作为输出，作为返回值，<code>inout</code>既可以作为输入又可以作为输出</li>
</ul>
</div>
<h4 id="系统变量">系统变量:</h4>
<ul>
<li>不需要用户自定义，属于服务器，分为全局变量<code>global</code>以及会话变量<code>session</code></li>
<li>会话变量表示在当前会话内有效</li>
<li>查询所有系统变量: <code>show [session | global] variables;</code></li>
<li>模糊查询: <code>show [session | global] variables like ...;</code></li>
<li>查询指定的系统变量，不写默认是<code>session</code>: <code>show @@[session | global].系统变量名;</code></li>
<li><code>MySQL</code>重启后，设置的<code>global</code>会失效，需要在<code>my.cnf</code>中完成设置才能保持</li>
</ul>
<h4 id="用户自定义变量">用户自定义变量</h4>
<ul>
<li>直接<code>@变量名</code>即可</li>
<li>赋值自定义变量:  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="variable">@var_name</span> <span class="operator">=</span> expr[, <span class="variable">@var_name</span> <span class="operator">=</span> expr, ...];</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@var_name</span> :<span class="operator">=</span> expr[, <span class="variable">@var_name</span> :<span class="operator">=</span> expr, ...];</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@var_name</span> :<span class="operator">=</span> expr</span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">into</span> <span class="variable">@var_name</span> <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure>
</li>
<li>使用<code>select @varname</code>，如果<code>var_name</code>没有赋值，这个语句不会报错，只会显示<code>null</code></li>
</ul>
<h4 id="局部变量">局部变量</h4>
<ul>
<li>使用<code>declare</code>申明，存储过程内的局部变量和输入参数，在<code>begin ... end</code>模块内生效</li>
<li>声明变量: <code>declare 变量名 变量类型 [default ...];</code></li>
<li>赋值局部变量:  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> 变量名 <span class="operator">=</span> 值;</span><br><span class="line"><span class="keyword">set</span> 变量名 :<span class="operator">=</span> 值;</span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">into</span> 变量名 <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="case"><code>case</code></h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> case_value</span><br><span class="line">	<span class="keyword">when</span> value1 <span class="keyword">then</span> statement1</span><br><span class="line">	<span class="keyword">when</span> value2 <span class="keyword">then</span> statement2</span><br><span class="line">	<span class="keyword">else</span> statement3</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">case</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> </span><br><span class="line">	<span class="keyword">when</span> condition1 <span class="keyword">then</span> statement1</span><br><span class="line">	<span class="keyword">when</span> condition2 <span class="keyword">then</span> statement2</span><br><span class="line">	<span class="keyword">else</span> statement3</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">case</span>;</span><br></pre></td></tr></table></figure>
<h3 id="while"><code>while</code></h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">while 条件 do</span><br><span class="line">	<span class="comment">-- sql语句</span></span><br><span class="line"><span class="keyword">end</span> while;</span><br></pre></td></tr></table></figure>
<h3 id="repeat"><code>repeat</code></h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">repeat</span><br><span class="line">	<span class="comment">-- sql语句</span></span><br><span class="line">	until 条件</span><br><span class="line"><span class="keyword">end</span> repeat; <span class="comment">-- 满足条件就退出循环</span></span><br></pre></td></tr></table></figure>
<h3 id="loop"><code>loop</code></h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[begin_label:] loop</span><br><span class="line">	<span class="comment">-- sql语句</span></span><br><span class="line"><span class="keyword">end</span> loop[end_label];</span><br><span class="line">leave [label] <span class="comment">-- 退出指定的循环</span></span><br><span class="line">iterate [label] <span class="comment">-- 跳过当前循环直接进入下一次循环</span></span><br><span class="line"><span class="comment">-- 如果不退出就是死循环</span></span><br></pre></td></tr></table></figure>
<h3 id="游标">游标</h3>
<ul>
<li>用于存储查询结果集的数据类型，在存储过程个函数中可以使用游标对结果集进行循环处理，包括游标声明，<code>open, fetch, close</code></li>
<li>声明游标: <code>declare 游标名称 cursor for 查询语句;</code></li>
<li>打开游标: <code>open 游标名称;</code></li>
<li>打开游标后才能获取游标记录: <code>fetch 游标名称 into 变量[, 变量];</code></li>
<li>关闭游标: <code>close 游标名称;</code></li>
</ul>
<h3 id="例子-2">例子:</h3>
<ol>
<li>根据传入参数<code>uage</code>, 查询<code>user</code>表，用户年龄小于等于<code>uage</code>的用户姓名<code>name</code>和专业<code>profession</code>插入到创建的一张表<code>id, name, profession</code>中 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p(<span class="keyword">in</span> uage <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> uname <span class="type">varchar</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">declare</span> upro <span class="type">varchar</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">declare</span> u_cursor <span class="keyword">cursor</span> <span class="keyword">for</span> <span class="keyword">select</span> name, profession <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> age <span class="operator">&lt;=</span> uage;</span><br><span class="line">    <span class="comment">-- 游标的申明应该放在普通变量后面</span></span><br><span class="line">    <span class="keyword">declare</span> exit handler <span class="keyword">for</span> <span class="keyword">sqlstate</span> <span class="string">&#x27;02000&#x27;</span> <span class="keyword">close</span> u_cursor;</span><br><span class="line">    <span class="comment">-- 满足SQL状态码是02000的, 触发退出操作，关闭游标u_cursor</span></span><br><span class="line">    <span class="comment">-- 同样可以将sqlstate &#x27;02000&#x27; 替换成not found</span></span><br><span class="line">    <span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> user_pro;</span><br><span class="line">    <span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> user_pro(</span><br><span class="line">        id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">        name <span class="type">varchar</span>(<span class="number">100</span>),</span><br><span class="line">        profession <span class="type">varchar</span>(<span class="number">100</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> u_cursor;</span><br><span class="line">    while <span class="literal">true</span> do </span><br><span class="line">        <span class="keyword">fetch</span> u_cursor <span class="keyword">into</span> uname, upro;</span><br><span class="line">        <span class="keyword">insert</span> <span class="keyword">into</span> user_pro <span class="keyword">values</span>(<span class="keyword">null</span>, uname, upro);</span><br><span class="line">    <span class="keyword">end</span> while; <span class="comment">-- 但是这里是死循环，因为不知道游标什么时候会结束</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">close</span> u_cursor;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>条件处理程序<code>handler</code>定义在流程遇到问题和相应的处理步骤</li>
<li><code>declare handler_action handler for condition_value[, condition_value ...] statement;</code></li>
<li><code>handler_action</code>包括两个内容，<code>continue</code>以及<code>exit</code></li>
<li><code>condition_value</code>有<code>SQLSTATE sqlstate_value</code>状态码，比如<code>02000</code>; <code>sqlwarning</code>是所有以<code>01</code>开头的<code>sqlstate</code>代码的缩写，<code>not found</code>是所有以<code>02</code>开头的代码的缩写，<code>sqlexception</code>是所有其他的<code>sqlstate</code>代码的缩写</li>
</ul>
</li>
</ol>
<h2 id="存储函数">存储函数</h2>
<div class="note info flat"><ul>
<li>就是有返回值的存储过程，并且参数只能为<code>in</code>类型，可以被存储过程替代</li>
</ul>
</div>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> 存储函数名([参数列表])</span><br><span class="line"><span class="keyword">return</span> type [characteristic ...]</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="comment">-- SQL语句</span></span><br><span class="line">    <span class="keyword">return</span> ...;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<p><code>characteristic</code>:</p>
<ul>
<li><code>deterministic</code>: 相同的输入参数总是产生相同的结果</li>
<li><code>no sql</code>: 不包含<code>SQL</code>语句</li>
<li><code>reads sql data</code>: 包含读取数据的语句，但是不包含写入数据的语句</li>
</ul>
<h2 id="触发器">触发器</h2>
<div class="note info flat"><ul>
<li>不建议使用</li>
<li><code>MySQL</code>只支持行级触发器，不支持语句级触发器，因此一次修改多行，就会触发多次</li>
</ul>
</div>
<table>
<thead>
<tr>
<th style="text-align:center">触发器类型</th>
<th style="text-align:center">NEW 和 OLD</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">INSERT型</td>
<td style="text-align:center">NEW表示将要或者已经新增的数据</td>
</tr>
<tr>
<td style="text-align:center">UPDATE型</td>
<td style="text-align:center">OLD表示修改之前的数据，NEW表示将要或已经修改的数据</td>
</tr>
<tr>
<td style="text-align:center">DELETE型</td>
<td style="text-align:center">OLD表示将要或已经删除的数据</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>创建触发器:</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trigger_name </span><br><span class="line">before<span class="operator">/</span>after <span class="keyword">insert</span><span class="operator">/</span> <span class="keyword">update</span><span class="operator">/</span> <span class="keyword">delete</span> </span><br><span class="line"><span class="keyword">on</span> 表名 <span class="keyword">for</span> eachrow </span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">    <span class="comment">-- trigger_stmt; </span></span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查看触发器: <code>show triggers;</code></p>
</li>
<li>
<p>删除触发器: <code>drop triggers [schema_name.]trigger_namel</code> 如果没有指定<code>schema_name</code>，默认为当前数据库</p>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://sangs3112.github.io">Sangs</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://sangs3112.github.io/posts/be4e57f0.html">https://sangs3112.github.io/posts/be4e57f0.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://sangs3112.github.io" target="_blank">Sangs Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a><a class="post-meta__tags" href="/tags/SQL%E4%BC%98%E5%8C%96/">SQL优化</a><a class="post-meta__tags" href="/tags/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/">存储过程</a><a class="post-meta__tags" href="/tags/%E8%A7%A6%E5%8F%91%E5%99%A8/">触发器</a><a class="post-meta__tags" href="/tags/%E8%A7%86%E5%9B%BE/">视图</a></div><div class="post_share"><div class="social-share" data-image="/img/avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/c9496766.html" title="MySQL笔记_2"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL笔记_2</div></div></a></div><div class="next-post pull-right"><a href="/posts/202ac253.html" title="MySQL笔记_4"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MySQL笔记_4</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Sangs</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">47</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">80</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Sangs3112" target="_blank" title="Github"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-fill"></use></svg></a><a class="social-icon" href="mailto:Sangs3112@163.com" target="_blank" title="Email"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-002_youxiang"></use></svg></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">SQL优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#insert%E4%BC%98%E5%8C%96"><span class="toc-number">1.1.</span> <span class="toc-text">insert优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E4%BC%98%E5%8C%96"><span class="toc-number">1.2.</span> <span class="toc-text">主键优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E9%A1%BA%E5%BA%8F%E6%8F%92%E5%85%A5"><span class="toc-number">1.2.1.</span> <span class="toc-text">主键顺序插入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E4%B9%B1%E5%BA%8F%E6%8F%92%E5%85%A5"><span class="toc-number">1.2.2.</span> <span class="toc-text">主键乱序插入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">1.2.3.</span> <span class="toc-text">主键设计原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#order-by%E4%BC%98%E5%8C%96"><span class="toc-number">1.3.</span> <span class="toc-text">order by优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">1.3.1.</span> <span class="toc-text">排序设计原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#limit%E4%BC%98%E5%8C%96"><span class="toc-number">1.4.</span> <span class="toc-text">limit优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#count%E4%BC%98%E5%8C%96"><span class="toc-number">1.5.</span> <span class="toc-text">count优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E7%B3%BB%E7%BB%9F%E8%AE%A1%E6%95%B0"><span class="toc-number">1.5.1.</span> <span class="toc-text">缓存系统计数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%A1%E6%95%B0"><span class="toc-number">1.5.2.</span> <span class="toc-text">数据库计数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#update%E4%BC%98%E5%8C%96"><span class="toc-number">1.6.</span> <span class="toc-text">update优化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">存储对象: 视图、存储过程、触发器、存储函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">2.1.</span> <span class="toc-text">视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E"><span class="toc-number">2.1.1.</span> <span class="toc-text">增</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0"><span class="toc-number">2.1.2.</span> <span class="toc-text">删</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B9"><span class="toc-number">2.1.3.</span> <span class="toc-text">改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5"><span class="toc-number">2.1.4.</span> <span class="toc-text">查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cascade"><span class="toc-number">2.1.5.</span> <span class="toc-text">cascade</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#local"><span class="toc-number">2.1.6.</span> <span class="toc-text">local</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E4%BD%9C%E7%94%A8"><span class="toc-number">2.1.7.</span> <span class="toc-text">视图作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-number">2.1.8.</span> <span class="toc-text">例子:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">2.2.</span> <span class="toc-text">存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E-2"><span class="toc-number">2.2.1.</span> <span class="toc-text">增</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0-2"><span class="toc-number">2.2.2.</span> <span class="toc-text">删</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E7%94%A8"><span class="toc-number">2.2.3.</span> <span class="toc-text">调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5-2"><span class="toc-number">2.2.4.</span> <span class="toc-text">查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">2.2.5.</span> <span class="toc-text">变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-number">2.2.5.1.</span> <span class="toc-text">系统变量:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F"><span class="toc-number">2.2.5.2.</span> <span class="toc-text">用户自定义变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F"><span class="toc-number">2.2.5.3.</span> <span class="toc-text">局部变量</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#case"><span class="toc-number">2.2.6.</span> <span class="toc-text">case</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#while"><span class="toc-number">2.2.7.</span> <span class="toc-text">while</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#repeat"><span class="toc-number">2.2.8.</span> <span class="toc-text">repeat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loop"><span class="toc-number">2.2.9.</span> <span class="toc-text">loop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87"><span class="toc-number">2.2.10.</span> <span class="toc-text">游标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90-2"><span class="toc-number">2.2.11.</span> <span class="toc-text">例子:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-number">2.3.</span> <span class="toc-text">存储函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">2.4.</span> <span class="toc-text">触发器</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/b92393e9.html" title="MySQL笔记_7">MySQL笔记_7</a><time datetime="2025-08-25T10:41:31.954Z" title="发表于 2025-08-25 18:41:31">2025-08-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/ce24a37f.html" title="MySQL笔记_6">MySQL笔记_6</a><time datetime="2025-08-25T10:41:31.954Z" title="发表于 2025-08-25 18:41:31">2025-08-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/f86b96e2.html" title="Go笔记_0">Go笔记_0</a><time datetime="2025-08-25T10:41:31.950Z" title="发表于 2025-08-25 18:41:31">2025-08-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/8f6ca674.html" title="Go笔记_1">Go笔记_1</a><time datetime="2025-08-25T10:41:31.950Z" title="发表于 2025-08-25 18:41:31">2025-08-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/53c118f0.html" title="SpringBoot笔记_0">SpringBoot笔记_0</a><time datetime="2025-04-22T06:37:35.000Z" title="发表于 2025-04-22 14:37:35">2025-04-22</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.8/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/metingjs/dist/Meting.min.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="Hexo" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/Sangs3112" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="/js/ali_font.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('article-sort-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__slideInRight');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --></body></html>